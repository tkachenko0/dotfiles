#!/bin/bash
set -e

if [ -z "$1" ]; then
  echo " Error: Usage: git-squash-to-one <base-branch>"
  exit 1
fi

BASE_BRANCH=$1

# Trova tutti i commit dopo il base branch
COMMITS=$(git rev-list --reverse "$BASE_BRANCH"..HEAD)

if [ -z "$COMMITS" ]; then
  echo "No commits to squash (branch already up to date with $BASE_BRANCH)"
  exit 0
fi

FIRST_COMMIT=$(echo "$COMMITS" | head -n 1)
FIRST_MSG=$(git log -1 --pretty=%B "$FIRST_COMMIT")

echo "Squashing all commits since $BASE_BRANCH into one..."
git reset --soft "$BASE_BRANCH"
git commit -m "$FIRST_MSG"

echo "All commits squashed into one!"
git log -2 --oneline
